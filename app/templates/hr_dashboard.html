<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR ÎåÄÏãúÎ≥¥Îìú - AIRISS v4.0</title>
    
    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@5.12.8/dist/reset.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 0;
        }
        
        .hr-dashboard {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.03), 0 1px 6px -1px rgba(0,0,0,0.02);
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .section {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.03), 0 1px 6px -1px rgba(0,0,0,0.02);
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
        }
        
        .employee-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .employee-table th,
        .employee-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            text-align: left;
        }
        
        .employee-table th {
            background: #fafafa;
            font-weight: 600;
        }
        
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        
        .tag-blue { background: #e6f7ff; color: #1890ff; }
        .tag-purple { background: #f9f0ff; color: #722ed1; }
        .tag-red { background: #fff1f0; color: #ff4d4f; }
        .tag-orange { background: #fff7e6; color: #fa8c16; }
        .tag-green { background: #f6ffed; color: #52c41a; }
        
        .progress-bar {
            background: #f5f5f5;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .progress-success { background: #52c41a; }
        .progress-warning { background: #faad14; }
        .progress-error { background: #ff4d4f; }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            margin-left: 8px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        .alert {
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
        }
        
        .alert-info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
    </style>
</head>
<body>
    <div id="hr-dashboard-root">
        <div class="loading">HR ÎåÄÏãúÎ≥¥Îìú Î°úÎî© Ï§ë...</div>
    </div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script>
        const { useState, useEffect, createElement: h } = React;
        
        function HRDashboard() {
            const [loading, setLoading] = useState(true);
            const [data, setData] = useState(null);
            const [error, setError] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [employees, setEmployees] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedEmployee, setSelectedEmployee] = useState(null);
            const [employeeDetail, setEmployeeDetail] = useState(null);
            
            useEffect(() => {
                fetchData();
            }, []);
            
            const fetchData = async () => {
                try {
                    console.log('API Ìò∏Ï∂ú ÏãúÏûë...');
                    const response = await fetch('/api/v1/hr-dashboard/stats');
                    if (!response.ok) throw new Error('API Ìò∏Ï∂ú Ïã§Ìå®');
                    const result = await response.json();
                    console.log('API Îç∞Ïù¥ÌÑ∞:', result);
                    setData(result);
                    setError(null);
                    
                    // Ï†ÑÏ≤¥ ÏßÅÏõê Îç∞Ïù¥ÌÑ∞ÎèÑ Í∞ÄÏ†∏Ïò§Í∏∞
                    const empResponse = await fetch('/api/v1/employees');
                    if (empResponse.ok) {
                        const empData = await empResponse.json();
                        setEmployees(empData.results || []);
                    }
                } catch (err) {
                    console.error('Ïò§Î•ò:', err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };
            
            const downloadPdf = async () => {
                try {
                    const response = await fetch('/api/v1/hr-dashboard/export/pdf');
                    if (!response.ok) throw new Error('PDF Îã§Ïö¥Î°úÎìú Ïã§Ìå®');
                    
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `HR_Dashboard_${new Date().toISOString().slice(0, 10)}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } catch (err) {
                    alert('PDF Îã§Ïö¥Î°úÎìú Ïã§Ìå®: ' + err.message);
                }
            };
            
            const renderPromotionCandidates = () => {
                if (!data?.promotion_candidates) return null;
                
                const { count, candidates, has_candidates } = data.promotion_candidates;
                
                if (!has_candidates) {
                    return h('div', { className: 'section' },
                        h('h3', { className: 'section-title' }, 'ÏäπÏßÑ ÌõÑÎ≥¥Ïûê ÏòàÏ∏°'),
                        h('div', { className: 'alert alert-info' },
                            h('strong', null, 'ÌòÑÏû¨ ÏäπÏßÑ ÌõÑÎ≥¥ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§'),
                            h('br'),
                            'ÌèâÍ∞ÄÎì±Í∏â, Í∑ºÏÜçÏó∞Ïàò, Ïó≠ÎüâÏ†êÏàò, Î¶¨ÎçîÏã≠ Îì±ÏùÑ Ï¢ÖÌï© ÌèâÍ∞ÄÌïú Í≤∞Í≥º ÌòÑÏû¨ ÏäπÏßÑ Í∏∞Ï§Ä(70Ï†ê Ïù¥ÏÉÅ)ÏùÑ Ï∂©Ï°±ÌïòÎäî ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.'
                        )
                    );
                }
                
                return h('div', { className: 'section' },
                    h('h3', { className: 'section-title' }, `ÏäπÏßÑ ÌõÑÎ≥¥Ïûê ÏòàÏ∏° (${count}Î™Ö)`),
                    h('table', { className: 'employee-table' },
                        h('thead',
                            h('tr',
                                h('th', null, 'ÏßÅÏõêÎ™Ö'),
                                h('th', null, 'Î∂ÄÏÑú'),
                                h('th', null, 'ÏßÅÍ∏â'),
                                h('th', null, 'Ï†êÏàò'),
                                h('th', null, 'ÌåêÎã® ÏÇ¨Ïú†')
                            )
                        ),
                        h('tbody',
                            candidates.map(emp => 
                                h('tr', { key: emp.uid },
                                    h('td', null, emp.name),
                                    h('td', null, emp.department),
                                    h('td', null, emp.position),
                                    h('td', null, 
                                        h('div', { className: 'progress-bar' },
                                            h('div', { 
                                                className: `progress-fill ${emp.score >= 90 ? 'progress-success' : emp.score >= 70 ? 'progress-warning' : 'progress-error'}`,
                                                style: { width: `${emp.score}%` }
                                            })
                                        ),
                                        h('small', null, `${emp.score}Ï†ê`)
                                    ),
                                    h('td', null,
                                        emp.reasons.map((reason, idx) =>
                                            h('span', { key: idx, className: 'tag tag-blue' }, reason)
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            };
            
            const renderTopTalents = () => {
                if (!data?.top_talents) return null;
                
                const { count, employees } = data.top_talents;
                
                return h('div', { className: 'section' },
                    h('h3', { className: 'section-title' }, `Top Talent (${count}Î™Ö)`),
                    h('table', { className: 'employee-table' },
                        h('thead',
                            h('tr',
                                h('th', null, 'ÏàúÏúÑ'),
                                h('th', null, 'ÏßÅÏõêÎ™Ö'),
                                h('th', null, 'Î∂ÄÏÑú'),
                                h('th', null, 'Îì±Í∏â'),
                                h('th', null, 'Ï†êÏàò'),
                                h('th', null, 'ÌåêÎã® ÏÇ¨Ïú†')
                            )
                        ),
                        h('tbody',
                            employees.map((emp, idx) => 
                                h('tr', { key: emp.uid },
                                    h('td', null, idx + 1),
                                    h('td', null, emp.name),
                                    h('td', null, emp.department),
                                    h('td', null, 
                                        h('span', { 
                                            className: `tag ${emp.grade === 'S' ? 'tag-green' : emp.grade === 'A' ? 'tag-blue' : 'tag-orange'}` 
                                        }, emp.grade)
                                    ),
                                    h('td', null, `${emp.score}Ï†ê`),
                                    h('td', null,
                                        emp.reasons.slice(0, 2).map((reason, ridx) =>
                                            h('span', { key: ridx, className: 'tag tag-purple' }, reason)
                                        ),
                                        emp.reasons.length > 2 && h('span', { className: 'tag' }, `+${emp.reasons.length - 2}Í∞ú`)
                                    )
                                )
                            )
                        )
                    )
                );
            };
            
            const renderRiskEmployees = () => {
                if (!data?.risk_employees) return null;
                
                const { count, employees, high_risk_count, medium_risk_count } = data.risk_employees;
                
                return h('div', { className: 'section' },
                    h('h3', { className: 'section-title' }, 
                        `Í¥ÄÎ¶¨ ÌïÑÏöî Ïù∏Î†• (Ï¥ù ${count}Î™Ö)`,
                        h('span', { style: { fontSize: '14px', fontWeight: 'normal', marginLeft: '10px' } },
                            h('span', { className: 'tag tag-red' }, `Í≥†ÏúÑÌóò ${high_risk_count}Î™Ö`),
                            h('span', { className: 'tag tag-orange' }, `Ï§ëÏúÑÌóò ${medium_risk_count}Î™Ö`)
                        )
                    ),
                    h('p', { style: { color: '#666', marginBottom: '16px' } },
                        'ÏÑ±Í≥º, Í∑ºÌÉú, Ïù¥ÏßÅÏúÑÌóòÎèÑ, Ïó≠Îüâ Îì±ÏùÑ Ï¢ÖÌï© ÌèâÍ∞ÄÌïòÏó¨ Í¥ÄÎ¶¨Í∞Ä ÌïÑÏöîÌïú Ïù∏Î†•ÏùÑ ÏãùÎ≥ÑÌï©ÎãàÎã§.'
                    ),
                    h('table', { className: 'employee-table' },
                        h('thead',
                            h('tr',
                                h('th', null, 'ÏßÅÏõêÎ™Ö'),
                                h('th', null, 'Î∂ÄÏÑú'),
                                h('th', null, 'ÏúÑÌóòÎèÑ'),
                                h('th', null, 'ÏúÑÌóòÏ†êÏàò'),
                                h('th', null, 'Í¥ÄÎ¶¨ ÌïÑÏöî ÏÇ¨Ïú†')
                            )
                        ),
                        h('tbody',
                            employees.slice(0, 10).map(emp => 
                                h('tr', { key: emp.uid },
                                    h('td', null, emp.name),
                                    h('td', null, emp.department),
                                    h('td', null, 
                                        h('span', { 
                                            className: `tag ${emp.risk_level === 'high' ? 'tag-red' : 'tag-orange'}` 
                                        }, emp.risk_level === 'high' ? 'ÎÜíÏùå' : 'Î≥¥ÌÜµ')
                                    ),
                                    h('td', null, 
                                        h('div', { className: 'progress-bar' },
                                            h('div', { 
                                                className: 'progress-fill progress-error',
                                                style: { width: `${emp.risk_score}%` }
                                            })
                                        ),
                                        h('small', null, `${emp.risk_score}Ï†ê`)
                                    ),
                                    h('td', null,
                                        emp.reasons.map((reason, ridx) =>
                                            h('span', { 
                                                key: ridx, 
                                                className: `tag ${reason.includes('Î∂ÄÏßÑ') || reason.includes('ÏúÑÌóò') ? 'tag-red' : 'tag-orange'}` 
                                            }, reason)
                                        )
                                    )
                                )
                            )
                        )
                    )
                );
            };
            
            const renderGradeChart = () => {
                if (!data?.grade_distribution) return null;
                
                // Í∞ÑÎã®Ìïú CSS ÎßâÎåÄÍ∑∏ÎûòÌîÑÎ°ú ÎåÄÏ≤¥
                const maxCount = Math.max(...data.grade_distribution.map(g => g.count));
                
                return h('div', { className: 'section' },
                    h('h3', { className: 'section-title' }, 'ÌèâÍ∞Ä Îì±Í∏â Î∂ÑÌè¨'),
                    h('div', { style: { marginBottom: '20px' } },
                        data.grade_distribution.map(grade => 
                            h('div', { 
                                key: grade.grade, 
                                style: { 
                                    display: 'flex', 
                                    alignItems: 'center', 
                                    marginBottom: '12px',
                                    fontSize: '14px'
                                } 
                            },
                                h('div', { 
                                    style: { width: '60px', fontWeight: 'bold' } 
                                }, `${grade.grade}Îì±Í∏â`),
                                h('div', { 
                                    style: { 
                                        flex: 1, 
                                        height: '24px', 
                                        background: '#f5f5f5', 
                                        borderRadius: '4px', 
                                        position: 'relative',
                                        marginRight: '10px'
                                    } 
                                },
                                    h('div', {
                                        style: {
                                            height: '100%',
                                            width: `${(grade.count / maxCount) * 100}%`,
                                            background: grade.grade === 'S' ? '#ffd700' : 
                                                       grade.grade === 'A' ? '#4CAF50' :
                                                       grade.grade === 'B' ? '#2196F3' :
                                                       grade.grade === 'C' ? '#FF9800' : '#9E9E9E',
                                            borderRadius: '4px',
                                            transition: 'width 0.5s ease'
                                        }
                                    })
                                ),
                                h('div', { 
                                    style: { width: '80px', textAlign: 'right' } 
                                }, `${grade.count}Î™Ö (${grade.percentage}%)`)
                            )
                        )
                    ),
                    h('div', { className: 'stats-grid' },
                        data.grade_distribution.map(grade =>
                            h('div', { key: grade.grade, className: 'stat-card' },
                                h('div', { className: 'stat-number' }, grade.count),
                                h('div', { className: 'stat-label' }, `${grade.grade}Îì±Í∏â (${grade.percentage}%)`)
                            )
                        )
                    )
                );
            };
            
            if (loading) {
                return h('div', { className: 'loading' }, 'HR ÎåÄÏãúÎ≥¥Îìú Î°úÎî© Ï§ë...');
            }
            
            if (error) {
                return h('div', { className: 'hr-dashboard' },
                    h('div', { className: 'alert', style: { background: '#fff2f0', color: '#ff4d4f', border: '1px solid #ffccc7' } },
                        h('strong', null, 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: '), error
                    )
                );
            }
            
            const fetchEmployeeDetail = async (employeeId) => {
                try {
                    const response = await fetch(`/api/v1/employees/${employeeId}/ai-analysis`);
                    if (response.ok) {
                        const data = await response.json();
                        setEmployeeDetail(data);
                        setSelectedEmployee(employeeId);
                    }
                } catch (err) {
                    console.error('ÏßÅÏõê ÏÉÅÏÑ∏ Ï°∞Ìöå Ïã§Ìå®:', err);
                }
            };
            
            // Ï†ÑÏßÅÏõêÎ∂ÑÏÑù ÌÉ≠ Î†åÎçîÎßÅ
            const renderEmployeeAnalysis = () => {
                
                const filteredEmployees = employees.filter(emp => 
                    emp.uid?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    emp.employee_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    emp.id?.toLowerCase().includes(searchQuery.toLowerCase())
                );
                
                // Í∞úÏù∏Î≥Ñ ÏÉÅÏÑ∏ Î≥¥Í≥†ÏÑú Î™®Îã¨
                if (selectedEmployee && employeeDetail) {
                    return h('div', { className: 'section' },
                        h('div', { style: { marginBottom: '20px' } },
                            h('button', {
                                className: 'btn',
                                onClick: () => {
                                    setSelectedEmployee(null);
                                    setEmployeeDetail(null);
                                }
                            }, '‚Üê Î™©Î°ùÏúºÎ°ú')
                        ),
                        h('div', { style: { padding: '20px', background: '#f9f9f9', borderRadius: '8px' } },
                            h('h2', null, `${employeeDetail.employee_name || selectedEmployee} AI Î∂ÑÏÑù Î≥¥Í≥†ÏÑú`),
                            h('div', { className: 'stats-grid', style: { marginTop: '20px' } },
                                h('div', { className: 'stat-card' },
                                    h('div', { className: 'stat-number' }, Math.round(employeeDetail.ai_score || 0)),
                                    h('div', { className: 'stat-label' }, 'AI Ï¢ÖÌï©Ï†êÏàò')
                                ),
                                h('div', { className: 'stat-card' },
                                    h('div', { className: 'stat-number' }, employeeDetail.grade || 'C'),
                                    h('div', { className: 'stat-label' }, 'AI Îì±Í∏â')
                                ),
                                h('div', { className: 'stat-card' },
                                    h('div', { className: 'stat-number' }, Math.round(employeeDetail.text_score || 0)),
                                    h('div', { className: 'stat-label' }, 'Ï†ïÏÑ±ÌèâÍ∞Ä')
                                ),
                                h('div', { className: 'stat-card' },
                                    h('div', { className: 'stat-number' }, Math.round(employeeDetail.quantitative_score || 0)),
                                    h('div', { className: 'stat-label' }, 'Ï†ïÎüâÌèâÍ∞Ä')
                                )
                            ),
                            employeeDetail.strengths && h('div', { style: { marginTop: '20px' } },
                                h('h3', null, 'Í∞ïÏ†ê'),
                                h('ul', null,
                                    employeeDetail.strengths.map(s => h('li', { key: s }, s))
                                )
                            ),
                            employeeDetail.improvements && h('div', { style: { marginTop: '20px' } },
                                h('h3', null, 'Í∞úÏÑ†Ï†ê'),
                                h('ul', null,
                                    employeeDetail.improvements.map(i => h('li', { key: i }, i))
                                )
                            ),
                            employeeDetail.ai_comment && h('div', { style: { marginTop: '20px' } },
                                h('h3', null, 'AI Ï¢ÖÌï© ÌèâÍ∞Ä'),
                                h('p', { style: { background: 'white', padding: '15px', borderRadius: '4px' } },
                                    employeeDetail.ai_comment)
                            )
                        )
                    );
                }
                
                return h('div', { className: 'section' },
                    h('div', { style: { marginBottom: '20px', display: 'flex', gap: '10px' } },
                        h('input', {
                            type: 'text',
                            placeholder: 'ÏßÅÏõê Í≤ÄÏÉâ (Ïù¥Î¶Ñ, ÏÇ¨Î≤à, ID)',
                            value: searchQuery,
                            onChange: (e) => setSearchQuery(e.target.value),
                            style: {
                                flex: 1,
                                maxWidth: '400px',
                                padding: '8px 12px',
                                border: '1px solid #d9d9d9',
                                borderRadius: '4px',
                                fontSize: '14px'
                            }
                        }),
                        h('button', {
                            className: 'btn',
                            onClick: () => setSearchQuery('')
                        }, 'Ï¥àÍ∏∞Ìôî')
                    ),
                    h('div', { style: { marginBottom: '10px', color: '#666' } },
                        `Ï†ÑÏ≤¥ ${employees.length}Î™Ö Ï§ë ${filteredEmployees.length}Î™Ö ÌëúÏãú`
                    ),
                    h('table', { className: 'employee-table' },
                        h('thead',
                            h('tr',
                                h('th', null, 'ÏàúÎ≤à'),
                                h('th', null, 'ÏÇ¨Î≤à/ID'),
                                h('th', null, 'Ïù¥Î¶Ñ'),
                                h('th', null, 'Î∂ÄÏÑú'),
                                h('th', null, 'ÏßÅÍ∏â'),
                                h('th', null, 'AI Îì±Í∏â'),
                                h('th', null, 'AI Ï†êÏàò'),
                                h('th', null, 'Ï†ïÏÑ±ÌèâÍ∞Ä'),
                                h('th', null, 'Ï†ïÎüâÌèâÍ∞Ä'),
                                h('th', null, 'ÏÉÅÏÑ∏Î≥¥Í≥†ÏÑú')
                            )
                        ),
                        h('tbody',
                            filteredEmployees.slice(0, 50).map((emp, idx) =>
                                h('tr', { key: emp.id },
                                    h('td', null, idx + 1),
                                    h('td', null, emp.uid || emp.id?.slice(0, 8) || '-'),
                                    h('td', null, emp.employee_name || 'ÏùµÎ™Ö'),
                                    h('td', null, emp.department || 'ÎØ∏Ï†ï'),
                                    h('td', null, emp.position || 'ÎØ∏Ï†ï'),
                                    h('td', null,
                                        h('span', {
                                            className: `tag ${emp.grade === 'S' ? 'tag-green' : 
                                                           emp.grade === 'A' ? 'tag-blue' : 
                                                           emp.grade === 'B' ? 'tag-orange' : 'tag-red'}`
                                        }, emp.grade || 'C')
                                    ),
                                    h('td', null, Math.round(emp.overall_score || 0)),
                                    h('td', null, Math.round(emp.text_score || 0)),
                                    h('td', null, Math.round(emp.quantitative_score || 0)),
                                    h('td', null,
                                        h('button', {
                                            className: 'btn btn-primary',
                                            onClick: () => fetchEmployeeDetail(emp.id),
                                            style: { padding: '4px 12px', fontSize: '12px' }
                                        }, 'AI Î≥¥Í≥†ÏÑú')
                                    )
                                )
                            )
                        )
                    ),
                    filteredEmployees.length > 50 && 
                        h('div', { style: { marginTop: '10px', textAlign: 'center', color: '#666' } },
                            `${filteredEmployees.length}Î™Ö Ï§ë 50Î™ÖÎßå ÌëúÏãú (Í≤ÄÏÉâÏúºÎ°ú ÌïÑÌÑ∞ÎßÅÌïòÏÑ∏Ïöî)`)
                );
            };
            
            return h('div', { className: 'hr-dashboard' },
                // Header
                h('div', { className: 'header' },
                    h('div', null,
                        h('h1', null, 'HR ÎåÄÏãúÎ≥¥Îìú'),
                        h('p', { style: { color: '#666', margin: 0 } }, 'AI Í∏∞Î∞ò Ïù∏Ïû¨ Î∂ÑÏÑù Î∞è ÏòàÏ∏° ÏãúÏä§ÌÖú')
                    ),
                    h('div', null,
                        h('button', { 
                            className: 'btn', 
                            onClick: fetchData 
                        }, 'üîÑ ÏÉàÎ°úÍ≥†Ïπ®'),
                        h('button', { 
                            className: 'btn btn-primary', 
                            onClick: downloadPdf 
                        }, 'üìÑ PDF Îã§Ïö¥Î°úÎìú')
                    )
                ),
                
                // ÌÉ≠ Î©îÎâ¥
                h('div', { style: { 
                    borderBottom: '2px solid #f0f0f0', 
                    marginBottom: '20px',
                    display: 'flex',
                    gap: '20px'
                } },
                    h('button', {
                        onClick: () => setActiveTab('dashboard'),
                        style: {
                            padding: '10px 20px',
                            background: 'none',
                            border: 'none',
                            borderBottom: activeTab === 'dashboard' ? '2px solid #1890ff' : '2px solid transparent',
                            color: activeTab === 'dashboard' ? '#1890ff' : '#666',
                            fontSize: '16px',
                            cursor: 'pointer',
                            marginBottom: '-2px'
                        }
                    }, 'Í≤ΩÏòÅÏßÑ ÎåÄÏãúÎ≥¥Îìú'),
                    h('button', {
                        onClick: () => setActiveTab('analysis'),
                        style: {
                            padding: '10px 20px',
                            background: 'none',
                            border: 'none',
                            borderBottom: activeTab === 'analysis' ? '2px solid #1890ff' : '2px solid transparent',
                            color: activeTab === 'analysis' ? '#1890ff' : '#666',
                            fontSize: '16px',
                            cursor: 'pointer',
                            marginBottom: '-2px'
                        }
                    }, 'Ï†ÑÏßÅÏõê Î∂ÑÏÑù')
                ),
                
                // ÌÉ≠Ïóê Îî∞Î•∏ ÏΩòÌÖêÏ∏† Î†åÎçîÎßÅ
                activeTab === 'dashboard' ? h('div', null,
                    // Stats Overview
                    h('div', { className: 'stats-grid' },
                        h('div', { className: 'stat-card' },
                            h('div', { className: 'stat-number', style: { color: '#1890ff' } }, data.total_employees),
                            h('div', { className: 'stat-label' }, 'Ï¥ù ÏßÅÏõê')
                        ),
                        h('div', { className: 'stat-card' },
                            h('div', { className: 'stat-number', style: { color: '#52c41a' } }, data.promotion_candidates.count),
                            h('div', { className: 'stat-label' }, 'ÏäπÏßÑ ÌõÑÎ≥¥Ïûê')
                        ),
                        h('div', { className: 'stat-card' },
                            h('div', { className: 'stat-number', style: { color: '#722ed1' } }, data.top_talents.count),
                            h('div', { className: 'stat-label' }, 'ÌïµÏã¨ Ïù∏Ïû¨')
                        ),
                        h('div', { className: 'stat-card' },
                            h('div', { className: 'stat-number', style: { color: '#ff4d4f' } }, data.risk_employees.count),
                            h('div', { className: 'stat-label' }, 'Í¥ÄÎ¶¨ ÌïÑÏöî')
                        )
                    ),
                    
                    // Sections
                    renderPromotionCandidates(),
                    renderTopTalents(),
                    renderRiskEmployees(),
                    renderGradeChart()
                ) : renderEmployeeAnalysis()
            );
        }
        
        // Wait for libraries and render
        function initDashboard() {
            let attempts = 0;
            const checkLibraries = () => {
                attempts++;
                if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined') {
                    console.log('‚úÖ React ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú ÏôÑÎ£å');
                    
                    const root = ReactDOM.createRoot(document.getElementById('hr-dashboard-root'));
                    root.render(React.createElement(HRDashboard));
                } else if (attempts < 50) {
                    setTimeout(checkLibraries, 100);
                } else {
                    console.error('‚ùå ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ïã§Ìå®');
                    document.getElementById('hr-dashboard-root').innerHTML = 
                        '<div class="loading" style="color: red;">ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ïã§Ìå®</div>';
                }
            };
            checkLibraries();
        }
        
        initDashboard();
    </script>
</body>
</html>