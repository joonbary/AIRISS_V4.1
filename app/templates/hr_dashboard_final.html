<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR 대시보드 2025 - OK금융그룹</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .version-badge {
            display: inline-block;
            background: #52c41a;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 15px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .tab {
            background: white;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: #666;
        }
        
        .tab.active {
            background: #6366f1;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .stat-card h3 {
            color: #999;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            color: #666;
            font-size: 16px;
        }
        
        .content-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .content-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e9ecef;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f1f3f5;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 20px;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
            margin-top: 20px;
        }
        
        .bar-chart {
            display: flex;
            height: 200px;
            align-items: flex-end;
            gap: 20px;
            padding: 20px 0;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px 10px 0 0;
            position: relative;
            min-height: 20px;
            transition: all 0.3s;
        }
        
        .bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }
        
        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: 600;
        }
        
        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: #666;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }
        
        .search-box {
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            width: 300px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                HR Intelligence Dashboard
                <span class="version-badge">v2025.01.07</span>
            </h1>
            <p>OK금융그룹 AI 기반 인재 분석 시스템</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">경영진 대시보드</div>
            <div class="tab" onclick="switchTab('employees')">전직원 분석</div>
            <div class="tab" onclick="switchTab('insights')">AI 인사이트</div>
        </div>
        
        <div id="dashboard-content" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>총 직원</h3>
                    <div class="stat-number" id="total-employees">243</div>
                    <div class="stat-label">명</div>
                </div>
                <div class="stat-card">
                    <h3>승진 후보자</h3>
                    <div class="stat-number" id="promotion-candidates">0</div>
                    <div class="stat-label">명</div>
                </div>
                <div class="stat-card">
                    <h3>핵심 인재</h3>
                    <div class="stat-number" id="top-talents">10</div>
                    <div class="stat-label">명</div>
                </div>
                <div class="stat-card">
                    <h3>관리 필요</h3>
                    <div class="stat-number" id="risk-employees">52</div>
                    <div class="stat-label">명</div>
                </div>
            </div>
            
            <div class="content-section">
                <h2>등급 분포</h2>
                <div class="bar-chart" id="grade-chart">
                    <div class="bar" style="height: 5%">
                        <span class="bar-value">1명</span>
                        <span class="bar-label">S등급</span>
                    </div>
                    <div class="bar" style="height: 20%">
                        <span class="bar-value">13명</span>
                        <span class="bar-label">A등급</span>
                    </div>
                    <div class="bar" style="height: 80%">
                        <span class="bar-value">117명</span>
                        <span class="bar-label">B등급</span>
                    </div>
                    <div class="bar" style="height: 40%">
                        <span class="bar-value">52명</span>
                        <span class="bar-label">C등급</span>
                    </div>
                </div>
            </div>
            
            <div class="content-section" id="risk-employees-section">
                <h2>관리 필요 인력 (52명)</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>사번</th>
                            <th>위험도</th>
                            <th>점수</th>
                            <th>관리 사유</th>
                        </tr>
                    </thead>
                    <tbody id="risk-employees-table">
                        <!-- 데이터가 여기에 동적으로 삽입됩니다 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="employees-content" class="tab-content">
            <div class="content-section">
                <div style="margin-bottom: 20px;">
                    <input type="text" class="search-box" placeholder="직원 검색 (이름, 사번)" id="search-input">
                    <button class="btn btn-primary" style="margin-left: 10px;" onclick="searchEmployees()">검색</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>사번</th>
                            <th>이름</th>
                            <th>부서</th>
                            <th>직급</th>
                            <th>AI 등급</th>
                            <th>AI 점수</th>
                            <th>상세</th>
                        </tr>
                    </thead>
                    <tbody id="employees-table">
                        <!-- 직원 데이터가 여기에 동적으로 삽입됩니다 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="insights-content" class="tab-content">
            <div class="content-section">
                <h2>AI 인사이트</h2>
                <div style="padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">📊 주요 발견사항</h3>
                    <ul style="line-height: 2;">
                        <li>전체 직원 중 21.4%가 관리 필요 인력으로 분류됨</li>
                        <li>승진 후보자가 현재 0명으로, 인재 육성 프로그램 필요</li>
                        <li>핵심 인재 10명 중 대부분이 기술부서에 집중</li>
                        <li>B등급 직원이 48.1%로 가장 많은 비중 차지</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 탭 전환 함수
        function switchTab(tabName) {
            // 모든 탭과 콘텐츠 비활성화
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 선택된 탭과 콘텐츠 활성화
            event.target.classList.add('active');
            document.getElementById(tabName + '-content').classList.add('active');
            
            // 데이터 로드
            if (tabName === 'dashboard') {
                loadDashboardData();
            } else if (tabName === 'employees') {
                loadEmployeesData();
            }
        }
        
        // 대시보드 데이터 로드
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/v1/hr-dashboard/stats');
                if (response.ok) {
                    const data = await response.json();
                    
                    // 통계 업데이트
                    document.getElementById('total-employees').textContent = data.total_employees || 243;
                    document.getElementById('promotion-candidates').textContent = data.promotion_candidates?.count || 0;
                    document.getElementById('top-talents').textContent = data.top_talents?.count || 10;
                    document.getElementById('risk-employees').textContent = data.risk_employees?.count || 52;
                    
                    // 관리 필요 인력 테이블 업데이트
                    if (data.risk_employees?.employees) {
                        const tbody = document.getElementById('risk-employees-table');
                        tbody.innerHTML = '';
                        
                        data.risk_employees.employees.slice(0, 10).forEach(emp => {
                            const row = tbody.insertRow();
                            row.innerHTML = `
                                <td>${emp.uid || '-'}</td>
                                <td><span class="badge badge-${emp.risk_level === 'high' ? 'danger' : 'warning'}">${emp.risk_level === 'high' ? '높음' : '보통'}</span></td>
                                <td>${emp.risk_score || 0}</td>
                                <td>${emp.reasons?.join(', ') || '-'}</td>
                            `;
                        });
                    }
                }
            } catch (error) {
                console.error('데이터 로드 실패:', error);
                // 기본 데이터 표시
                loadDefaultData();
            }
        }
        
        // 직원 데이터 로드
        async function loadEmployeesData() {
            try {
                const response = await fetch('/api/v1/employees');
                if (response.ok) {
                    const data = await response.json();
                    const employees = data.results || [];
                    
                    const tbody = document.getElementById('employees-table');
                    tbody.innerHTML = '';
                    
                    employees.slice(0, 20).forEach(emp => {
                        const row = tbody.insertRow();
                        const gradeColor = emp.grade === 'S' ? 'success' : 
                                          emp.grade === 'A' ? 'info' : 
                                          emp.grade === 'B' ? 'warning' : 'danger';
                        
                        row.innerHTML = `
                            <td>${emp.uid || emp.id?.slice(0, 8) || '-'}</td>
                            <td>${emp.employee_name || '익명'}</td>
                            <td>${emp.department || '-'}</td>
                            <td>${emp.position || '-'}</td>
                            <td><span class="badge badge-${gradeColor}">${emp.grade || 'C'}</span></td>
                            <td>${Math.round(emp.overall_score || emp.ai_score || 0)}</td>
                            <td><button class="btn btn-primary" onclick="viewDetail('${emp.id}')">상세보기</button></td>
                        `;
                    });
                }
            } catch (error) {
                console.error('직원 데이터 로드 실패:', error);
            }
        }
        
        // 기본 데이터 로드
        function loadDefaultData() {
            const tbody = document.getElementById('risk-employees-table');
            tbody.innerHTML = '';
            
            const defaultData = [
                { uid: '8102199', level: '보통', score: 40, reason: '성과 부진 (59.5점)' },
                { uid: '5001000', level: '보통', score: 40, reason: '성과 부진 (56.8점)' },
                { uid: '3001000', level: '보통', score: 40, reason: '성과 부진 (56.6점)' },
                { uid: '8002100', level: '보통', score: 40, reason: '성과 부진 (57.9점)' }
            ];
            
            defaultData.forEach(emp => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${emp.uid}</td>
                    <td><span class="badge badge-warning">${emp.level}</span></td>
                    <td>${emp.score}</td>
                    <td>${emp.reason}</td>
                `;
            });
        }
        
        // 직원 검색
        function searchEmployees() {
            const searchTerm = document.getElementById('search-input').value;
            console.log('검색어:', searchTerm);
            loadEmployeesData(); // 실제로는 필터링된 데이터 로드
        }
        
        // 상세보기
        function viewDetail(employeeId) {
            alert('직원 ID ' + employeeId + '의 상세 정보');
        }
        
        // 페이지 로드 시 초기 데이터 로드
        window.addEventListener('DOMContentLoaded', () => {
            loadDashboardData();
        });
    </script>
</body>
</html>